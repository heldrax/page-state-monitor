<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>État détaillé de la page</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  h2 { margin-bottom: 10px; }
  .box { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
  .state { font-size: 18px; margin: 8px 0; }
  .label { font-weight: bold; }
  #log { height: 200px; overflow-y: auto; background: #222; color: #0f0; padding: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h2>État détaillé de la page</h2>

<div class="box">
  <div class="state">VisibilityState : <span id="vis"></span></div>
  <div class="state">Fenêtre focus : <span id="focus"></span></div>
  <div class="state">Fenêtre blur : <span id="blur"></span></div>
  <div class="state">Page cachée (pagehide) : <span id="pagehide"></span></div>
  <div class="state">Page affichée (pageshow) : <span id="pageshow"></span></div>
  <div class="state">État freeze : <span id="freeze"></span></div>
  <div class="state">État resume : <span id="resume"></span></div>
</div>

<h3>Journal des événements</h3>
<div id="log"></div>

<script>
function log(msg) {
    const logBox = document.getElementById("log");
    const time = new Date().toLocaleTimeString();
    logBox.innerHTML += `[${time}] ${msg}<br>`;
    logBox.scrollTop = logBox.scrollHeight;
}

function updateVisibility() {
    document.getElementById("vis").textContent = document.visibilityState;
    log("visibilitychange → " + document.visibilityState);
}

document.getElementById("focus").textContent = document.hasFocus();
document.getElementById("blur").textContent = !document.hasFocus();
document.getElementById("vis").textContent = document.visibilityState;

// Événements principaux
document.addEventListener("visibilitychange", updateVisibility);

window.addEventListener("focus", () => {
    document.getElementById("focus").textContent = "true";
    document.getElementById("blur").textContent = "false";
    log("focus");
});

window.addEventListener("blur", () => {
    document.getElementById("focus").textContent = "false";
    document.getElementById("blur").textContent = "true";
    log("blur");
});

window.addEventListener("pagehide", () => {
    document.getElementById("pagehide").textContent = "true";
    log("pagehide");
});

window.addEventListener("pageshow", () => {
    document.getElementById("pageshow").textContent = "true";
    log("pageshow");
});

// API Page Lifecycle (Chrome)
document.addEventListener("freeze", () => {
    document.getElementById("freeze").textContent = "true";
    log("freeze (onglet mis en pause)");
});

document.addEventListener("resume", () => {
    document.getElementById("resume").textContent = "true";
    log("resume (onglet réactivé)");
});
</script>

</body>
</html>
